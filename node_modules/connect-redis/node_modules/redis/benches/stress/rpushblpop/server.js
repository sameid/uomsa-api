'use strict';

var freemem = require('os').freemem;
var codec = require('../codec');

var id = Math.random();
var recv = 0;

var cmd = require('redis').createClient();
var sub = require('redis').createClient()
	.on('ready', function() {
		this.emit('timeline');
***REMOVED***)
	.on('timeline', function() {
		var self = this;
		this.blpop('timeline', 0, function(err, result) {
			var message = result[1];
			if (message) {
				message = codec.decode(message);
				++recv;
		***REMOVED***
			self.emit('timeline');
	***REMOVED***);
***REMOVED***);

setInterval(function() {
	cmd.llen('timeline', function(err, result) {
		console.error('id', id, 'received', recv, 'free', freemem(), 'llen', result);
***REMOVED***);
***REMOVED***, 2000);
