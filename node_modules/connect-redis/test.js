
/**
 * Module dependencies.
 */

var assert = require('assert')
  , session = require('express-session')
  , RedisStore = require('./')(session);

var store = new RedisStore;
var store_alt = new RedisStore({ db: 15 ***REMOVED***);
var store_url = new RedisStore({ url: "redis://localhost:6379/db2" ***REMOVED***);

store.client.on('connect', function(){
  // #set()
  store.set('123', { cookie: { maxAge: 2000 ***REMOVED***, name: 'tj' ***REMOVED***, function(err, ok){
    assert.ok(!err, '#set() got an error');
    assert.ok(ok, '#set() is not ok');

    // #get()
    store.get('123', function(err, data){
      assert.ok(!err, '#get() got an error');
      assert.deepEqual({ cookie: { maxAge: 2000 ***REMOVED***, name: 'tj' ***REMOVED***, data);

      // #set null
      store.set('123', { cookie: { maxAge: 2000 ***REMOVED***, name: 'tj' ***REMOVED***, function(){
        store.destroy('123', function(){
         console.log('done');
         store.client.end(); 
         store_alt.client.end();
         store_url.client.end();
         process.exit(0);
        ***REMOVED***);
      ***REMOVED***);
      throw new Error('Error in fn');
    ***REMOVED***);
  ***REMOVED***);
***REMOVED***);

process.once('uncaughtException', function (err) {
  assert.ok(err.message === 'Error in fn', '#get() catch wrong error');
***REMOVED***);