var stringify = require('./stringify.js');

var circularObj = { a: 'b' ***REMOVED***;
circularObj.circularRef = circularObj;
circularObj.list = [ circularObj, circularObj ];

//////////
// default
var testObj = {
  "a": "b",
  "circularRef": "[Circular ~]",
  "list": [
    "[Circular ~]",
    "[Circular ~]"
  ]
***REMOVED***;

var assert = require('assert');
assert.equal(JSON.stringify(testObj, null, 2),
             stringify(circularObj, null, 2));

assert.equal(JSON.stringify(testObj, null, 2),
            JSON.stringify(circularObj, stringify.getSerialize(), 2));


////////
// prune
testObj = {
  "a": "b",
  "list": [
    null,
    null
  ]
***REMOVED***;

function prune(k, v) {***REMOVED***

assert.equal(JSON.stringify(testObj, null, 2),
             stringify(circularObj, null, 2, prune));

///////////
// re-cycle
// (throws)
function recycle(k, v) {
  return v;
***REMOVED***

assert.throws(function() {
  stringify(circularObj, null, 2, recycle);
***REMOVED***);

////////
// fancy
testObj = {
  "a": "b",
  "circularRef": "circularRef{a:string,circularRef:Object,list:Array***REMOVED***",
  "list": [
    "0{a:string,circularRef:Object,list:Array***REMOVED***",
    "1{a:string,circularRef:Object,list:Array***REMOVED***"
  ]
***REMOVED***;

function signer(key, value) {
  var ret = key + '{';
  var f = false;
  for (var i in value) {
    if (f)
      ret += ',';
    f = true;
    ret += i + ':';
    var v = value[i];
    switch (typeof v) {
      case 'object':
        if (!v)
          ret += 'null';
        else if (Array.isArray(v))
          ret += 'Array'
        else
          ret += v.constructor && v.constructor.name || 'Object';
        break;
      default:
        ret += typeof v;
        break;
    ***REMOVED***
  ***REMOVED***
  ret += '***REMOVED***';
  return ret;
***REMOVED***

assert.equal(JSON.stringify(testObj, null, 2),
             stringify(circularObj, null, 2, signer));


///////
//multi
var a = { x: 1 ***REMOVED***;
a.a = a;
var b = { x: 2 ***REMOVED***;
b.a = a;

var c = { a: a, b: b ***REMOVED***;
var d = { list: [ a, b, c ] ***REMOVED***;
d.d = d;

var multi = {
  "list": [
    {
      "x": 1,
      "a": "[Circular ~.list.0]"
    ***REMOVED***,
    {
      "x": 2,
      "a": "[Circular ~.list.0]"
    ***REMOVED***,
    {
      "a": "[Circular ~.list.0]",
      "b": "[Circular ~.list.1]"
    ***REMOVED***
  ],
  "d": "[Circular ~]"
***REMOVED***;

assert.equal(JSON.stringify(multi, null, 2),
             stringify(d, null, 2));

////////
// pass!
console.log('ok');
